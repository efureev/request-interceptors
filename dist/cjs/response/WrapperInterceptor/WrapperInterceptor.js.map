{"version":3,"file":"WrapperInterceptor.js","names":["errHandler","layerConfig","error","config","retry","Promise","reject","makeError","response","onThrowErrorFn","getExtra","isFunction","errorWrap","WrapperInterceptor","requestExtra","createResponseWrapper","ResponseWrapper","dataKey"],"sources":["../../../../src/response/WrapperInterceptor/WrapperInterceptor.ts"],"sourcesContent":["import makeError from '../../errors'\nimport ResponseWrapper from './ResponseWrapper'\nimport { isFunction } from '@feugene/mu'\nimport type { ExtraProperties, InterceptorFn, InterceptorNormal, LayerConfig } from '@feugene/layer-request'\nimport type { AxiosError, AxiosResponse } from 'axios'\n\n\nconst errHandler = (layerConfig: LayerConfig) => (error: AxiosError) => {\n  const { config } = error\n  // If config does not exist or the retry option is not set, reject\n  // @ts-ignore\n  if (!config || !config.retry) {\n    return Promise.reject(makeError(error))\n  }\n  if (!error.response) {\n    const onThrowErrorFn = layerConfig.getExtra('onThrowErrorFn')\n    if (isFunction(onThrowErrorFn)) {\n      return onThrowErrorFn(error, this)\n      // @todo create none http error\n      // return Promise.reject(makeError(error))\n    }\n  }\n\n  const errorWrap = makeError(error)\n\n  return Promise.reject(errorWrap)\n}\n\nconst WrapperInterceptor = (): InterceptorFn<AxiosResponse, ResponseWrapper> => {\n  return (layerConfig: LayerConfig, requestExtra: ExtraProperties): InterceptorNormal<AxiosResponse, ResponseWrapper> => [\n    (response: AxiosResponse): ResponseWrapper => createResponseWrapper(response, layerConfig),\n    errHandler(layerConfig),\n  ]\n}\nexport const createResponseWrapper = (response: AxiosResponse, layerConfig: LayerConfig) => new ResponseWrapper(\n  response,\n  layerConfig.getExtra('withoutDataBlock') ? { dataKey: '' } : {},\n)\n\nexport default WrapperInterceptor\n"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;;;;;AAKA,IAAMA,UAAU,GAAG,SAAbA,UAAa,CAACC,WAAD;EAAA,OAA8B,UAACC,KAAD,EAAuB;IACtE,IAAQC,MAAR,GAAmBD,KAAnB,CAAQC,MAAR,CADsE,CAEtE;IACA;;IACA,IAAI,CAACA,MAAD,IAAW,CAACA,MAAM,CAACC,KAAvB,EAA8B;MAC5B,OAAOC,OAAO,CAACC,MAAR,CAAe,IAAAC,eAAA,EAAUL,KAAV,CAAf,CAAP;IACD;;IACD,IAAI,CAACA,KAAK,CAACM,QAAX,EAAqB;MACnB,IAAMC,cAAc,GAAGR,WAAW,CAACS,QAAZ,CAAqB,gBAArB,CAAvB;;MACA,IAAI,IAAAC,cAAA,EAAWF,cAAX,CAAJ,EAAgC;QAC9B,OAAOA,cAAc,CAACP,KAAD,EAAQ,KAAR,CAArB,CAD8B,CAE9B;QACA;MACD;IACF;;IAED,IAAMU,SAAS,GAAG,IAAAL,eAAA,EAAUL,KAAV,CAAlB;IAEA,OAAOG,OAAO,CAACC,MAAR,CAAeM,SAAf,CAAP;EACD,CAnBkB;AAAA,CAAnB;;AAqBA,IAAMC,kBAAkB,GAAG,SAArBA,kBAAqB,GAAqD;EAC9E,OAAO,UAACZ,WAAD,EAA2Ba,YAA3B;IAAA,OAAgH,CACrH,UAACN,QAAD;MAAA,OAA8CO,qBAAqB,CAACP,QAAD,EAAWP,WAAX,CAAnE;IAAA,CADqH,EAErHD,UAAU,CAACC,WAAD,CAF2G,CAAhH;EAAA,CAAP;AAID,CALD;;AAMO,IAAMc,qBAAqB,GAAG,SAAxBA,qBAAwB,CAACP,QAAD,EAA0BP,WAA1B;EAAA,OAAuD,IAAIe,wBAAJ,CAC1FR,QAD0F,EAE1FP,WAAW,CAACS,QAAZ,CAAqB,kBAArB,IAA2C;IAAEO,OAAO,EAAE;EAAX,CAA3C,GAA6D,EAF6B,CAAvD;AAAA,CAA9B;;;eAKQJ,kB"}