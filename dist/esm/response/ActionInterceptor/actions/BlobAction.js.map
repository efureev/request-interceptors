{"version":3,"file":"BlobAction.js","names":["BaseAction","b64ToUtf8Safe","ResponseWrapper","getFileName","contentDisposition","value","split","buildReader","filename","fnOnDone","reader","FileReader","onloadend","url","result","replace","link","document","createElement","href","download","target","body","append","click","remove","BlobAction","run","configLayer","response","responseData","axiosResponse","data","headers","headerFilename","done","readAsDataURL","Blob","type"],"sources":["../../../../../src/response/ActionInterceptor/actions/BlobAction.ts"],"sourcesContent":["import BaseAction from './BaseAction'\nimport { b64ToUtf8Safe } from '@feugene/mu'\nimport type { LayerConfig } from '@feugene/layer-request'\nimport type { AxiosResponse } from 'axios'\nimport ResponseWrapper from '../../WrapperInterceptor/ResponseWrapper'\n\nconst getFileName = (contentDisposition?: string, value?: string): string => {\n  if (value) {\n    return value\n  }\n\n  if (contentDisposition) {\n    return contentDisposition.split('filename=')[1]\n  }\n\n  return 'download-file'\n}\n\nconst buildReader = (filename: string, fnOnDone: () => void) => {\n  const reader = new FileReader()\n\n  reader.onloadend = function () {\n    let url: string = <string>reader.result\n\n    url = url.replace(/^data:[^;]*;/, 'data:attachment/file;')\n\n    const link = document.createElement('a')\n\n    link.href = url\n    link.download = filename\n    link.target = '_blank'\n\n    document.body.append(link)\n    link.click()\n\n    link.remove()\n\n    fnOnDone()\n  }\n\n  return reader\n}\n\nexport default class BlobAction extends BaseAction {\n  public run(configLayer: LayerConfig, response: AxiosResponse | ResponseWrapper): void {\n    let responseData\n    let axiosResponse: AxiosResponse\n    if (response instanceof ResponseWrapper) {\n      axiosResponse = response.response\n    }\n    else {\n      responseData = response.data\n      axiosResponse = response\n    }\n\n\n    const contentDisposition: string = axiosResponse.headers['content-disposition']\n    const headerFilename: string = axiosResponse.headers['x-filename']\n\n    const filename = getFileName(contentDisposition, b64ToUtf8Safe(headerFilename))\n\n    buildReader(filename, () => {\n      this.done()\n    })\n      .readAsDataURL(\n        new Blob([responseData], {\n          type: responseData.type || 'application/octet-stream',\n        }),\n      )\n  }\n}\n"],"mappings":"AAAA,OAAOA,UAAP,MAAuB,cAAvB;AACA,SAASC,aAAT,QAA8B,aAA9B;AAGA,OAAOC,eAAP,MAA4B,0CAA5B;;AAEA,MAAMC,WAAW,GAAG,CAACC,kBAAD,EAA8BC,KAA9B,KAAyD;EAC3E,IAAIA,KAAJ,EAAW;IACT,OAAOA,KAAP;EACD;;EAED,IAAID,kBAAJ,EAAwB;IACtB,OAAOA,kBAAkB,CAACE,KAAnB,CAAyB,WAAzB,EAAsC,CAAtC,CAAP;EACD;;EAED,OAAO,eAAP;AACD,CAVD;;AAYA,MAAMC,WAAW,GAAG,CAACC,QAAD,EAAmBC,QAAnB,KAA4C;EAC9D,MAAMC,MAAM,GAAG,IAAIC,UAAJ,EAAf;;EAEAD,MAAM,CAACE,SAAP,GAAmB,YAAY;IAC7B,IAAIC,GAAW,GAAWH,MAAM,CAACI,MAAjC;IAEAD,GAAG,GAAGA,GAAG,CAACE,OAAJ,CAAY,cAAZ,EAA4B,uBAA5B,CAAN;IAEA,MAAMC,IAAI,GAAGC,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAb;IAEAF,IAAI,CAACG,IAAL,GAAYN,GAAZ;IACAG,IAAI,CAACI,QAAL,GAAgBZ,QAAhB;IACAQ,IAAI,CAACK,MAAL,GAAc,QAAd;IAEAJ,QAAQ,CAACK,IAAT,CAAcC,MAAd,CAAqBP,IAArB;IACAA,IAAI,CAACQ,KAAL;IAEAR,IAAI,CAACS,MAAL;IAEAhB,QAAQ;EACT,CAjBD;;EAmBA,OAAOC,MAAP;AACD,CAvBD;;AAyBA,eAAe,MAAMgB,UAAN,SAAyB1B,UAAzB,CAAoC;EAC1C2B,GAAG,CAACC,WAAD,EAA2BC,QAA3B,EAA4E;IACpF,IAAIC,YAAJ;IACA,IAAIC,aAAJ;;IACA,IAAIF,QAAQ,YAAY3B,eAAxB,EAAyC;MACvC6B,aAAa,GAAGF,QAAQ,CAACA,QAAzB;IACD,CAFD,MAGK;MACHC,YAAY,GAAGD,QAAQ,CAACG,IAAxB;MACAD,aAAa,GAAGF,QAAhB;IACD;;IAGD,MAAMzB,kBAA0B,GAAG2B,aAAa,CAACE,OAAd,CAAsB,qBAAtB,CAAnC;IACA,MAAMC,cAAsB,GAAGH,aAAa,CAACE,OAAd,CAAsB,YAAtB,CAA/B;IAEA,MAAMzB,QAAQ,GAAGL,WAAW,CAACC,kBAAD,EAAqBH,aAAa,CAACiC,cAAD,CAAlC,CAA5B;IAEA3B,WAAW,CAACC,QAAD,EAAW,MAAM;MAC1B,KAAK2B,IAAL;IACD,CAFU,CAAX,CAGGC,aAHH,CAII,IAAIC,IAAJ,CAAS,CAACP,YAAD,CAAT,EAAyB;MACvBQ,IAAI,EAAER,YAAY,CAACQ,IAAb,IAAqB;IADJ,CAAzB,CAJJ;EAQD;;AA1BgD"}