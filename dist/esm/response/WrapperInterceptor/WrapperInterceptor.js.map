{"version":3,"file":"WrapperInterceptor.js","names":["makeError","ResponseWrapper","isFunction","errHandler","layerConfig","error","config","retry","Promise","reject","response","onThrowErrorFn","getExtra","errorWrap","WrapperInterceptor","requestExtra","createResponseWrapper","dataKey"],"sources":["../../../../src/response/WrapperInterceptor/WrapperInterceptor.ts"],"sourcesContent":["import makeError from '../../errors'\nimport ResponseWrapper from './ResponseWrapper'\nimport { isFunction } from '@feugene/mu'\nimport type { ExtraProperties, InterceptorFn, InterceptorNormal, LayerConfig } from '@feugene/layer-request'\nimport type { AxiosError, AxiosResponse } from 'axios'\n\n\nconst errHandler = (layerConfig: LayerConfig) => (error: AxiosError) => {\n  const { config } = error\n  // If config does not exist or the retry option is not set, reject\n  // @ts-ignore\n  if (!config || !config.retry) {\n    return Promise.reject(makeError(error))\n  }\n  if (!error.response) {\n    const onThrowErrorFn = layerConfig.getExtra('onThrowErrorFn')\n    if (isFunction(onThrowErrorFn)) {\n      return onThrowErrorFn(error, this)\n      // @todo create none http error\n      // return Promise.reject(makeError(error))\n    }\n  }\n\n  const errorWrap = makeError(error)\n\n  return Promise.reject(errorWrap)\n}\n\nconst WrapperInterceptor = (): InterceptorFn<AxiosResponse, ResponseWrapper> => {\n  return (layerConfig: LayerConfig, requestExtra: ExtraProperties): InterceptorNormal<AxiosResponse, ResponseWrapper> => [\n    (response: AxiosResponse): ResponseWrapper => createResponseWrapper(response, layerConfig),\n    errHandler(layerConfig),\n  ]\n}\nexport const createResponseWrapper = (response: AxiosResponse, layerConfig: LayerConfig) => new ResponseWrapper(\n  response,\n  layerConfig.getExtra('withoutDataBlock') ? { dataKey: '' } : {},\n)\n\nexport default WrapperInterceptor\n"],"mappings":"AAAA,OAAOA,SAAP,MAAsB,cAAtB;AACA,OAAOC,eAAP,MAA4B,mBAA5B;AACA,SAASC,UAAT,QAA2B,aAA3B;;AAKA,MAAMC,UAAU,GAAIC,WAAD,IAA+BC,KAAD,IAAuB;EACtE,MAAM;IAAEC;EAAF,IAAaD,KAAnB,CADsE,CAEtE;EACA;;EACA,IAAI,CAACC,MAAD,IAAW,CAACA,MAAM,CAACC,KAAvB,EAA8B;IAC5B,OAAOC,OAAO,CAACC,MAAR,CAAeT,SAAS,CAACK,KAAD,CAAxB,CAAP;EACD;;EACD,IAAI,CAACA,KAAK,CAACK,QAAX,EAAqB;IACnB,MAAMC,cAAc,GAAGP,WAAW,CAACQ,QAAZ,CAAqB,gBAArB,CAAvB;;IACA,IAAIV,UAAU,CAACS,cAAD,CAAd,EAAgC;MAC9B,OAAOA,cAAc,CAACN,KAAD,EAAQ,IAAR,CAArB,CAD8B,CAE9B;MACA;IACD;EACF;;EAED,MAAMQ,SAAS,GAAGb,SAAS,CAACK,KAAD,CAA3B;EAEA,OAAOG,OAAO,CAACC,MAAR,CAAeI,SAAf,CAAP;AACD,CAnBD;;AAqBA,MAAMC,kBAAkB,GAAG,MAAqD;EAC9E,OAAO,CAACV,WAAD,EAA2BW,YAA3B,KAAgH,CACpHL,QAAD,IAA8CM,qBAAqB,CAACN,QAAD,EAAWN,WAAX,CADkD,EAErHD,UAAU,CAACC,WAAD,CAF2G,CAAvH;AAID,CALD;;AAMA,OAAO,MAAMY,qBAAqB,GAAG,CAACN,QAAD,EAA0BN,WAA1B,KAAuD,IAAIH,eAAJ,CAC1FS,QAD0F,EAE1FN,WAAW,CAACQ,QAAZ,CAAqB,kBAArB,IAA2C;EAAEK,OAAO,EAAE;AAAX,CAA3C,GAA6D,EAF6B,CAArF;AAKP,eAAeH,kBAAf"}