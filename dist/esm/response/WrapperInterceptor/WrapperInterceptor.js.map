{"version":3,"file":"WrapperInterceptor.js","names":["isNativeError","makeHttpError","ResponseWrapper","isFunction","errHandler","layerConfig","error","Promise","reject","config","retry","response","onThrowErrorFn","getExtra","errorWrap","WrapperInterceptor","requestExtra","createResponseWrapper","dataKey"],"sources":["../../../../src/response/WrapperInterceptor/WrapperInterceptor.ts"],"sourcesContent":["import { isNativeError, makeHttpError } from '../../errors'\nimport ResponseWrapper from './ResponseWrapper'\nimport { isFunction } from '@feugene/mu'\nimport type { ExtraProperties, InterceptorFn, InterceptorNormal, LayerConfig } from '@feugene/layer-request'\nimport type { AxiosError, AxiosResponse } from 'axios'\n\n\nconst errHandler = (layerConfig: LayerConfig) => (error: AxiosError | Error) => {\n  if (isNativeError(error)) {\n    return Promise.reject(error)\n  }\n\n  const { config } = <AxiosError>error\n  // If config does not exist or the retry option is not set, reject\n  // @ts-ignore\n  if (!config || !config.retry) {\n    return Promise.reject(makeHttpError(<AxiosError>error))\n  }\n\n  if (!(<AxiosError>error).response) {\n    const onThrowErrorFn = layerConfig.getExtra('onThrowErrorFn')\n    if (isFunction(onThrowErrorFn)) {\n      return onThrowErrorFn(error, this)\n      // @todo create none http error\n      // return Promise.reject(makeError(error))\n    }\n  }\n\n  const errorWrap = makeHttpError(<AxiosError>error)\n\n  return Promise.reject(errorWrap)\n}\n\nconst WrapperInterceptor = (): InterceptorFn<AxiosResponse, ResponseWrapper> => {\n  return (layerConfig: LayerConfig, requestExtra: ExtraProperties): InterceptorNormal<AxiosResponse, ResponseWrapper> => [\n    (response: AxiosResponse): ResponseWrapper => createResponseWrapper(response, layerConfig),\n    errHandler(layerConfig),\n  ]\n}\nexport const createResponseWrapper = (response: AxiosResponse, layerConfig: LayerConfig) => new ResponseWrapper(\n  response,\n  layerConfig.getExtra('withoutDataBlock') ? { dataKey: '' } : {},\n)\n\nexport default WrapperInterceptor\n"],"mappings":"AAAA,SAASA,aAAT,EAAwBC,aAAxB,QAA6C,cAA7C;AACA,OAAOC,eAAP,MAA4B,mBAA5B;AACA,SAASC,UAAT,QAA2B,aAA3B;;AAKA,MAAMC,UAAU,GAAIC,WAAD,IAA+BC,KAAD,IAA+B;EAC9E,IAAIN,aAAa,CAACM,KAAD,CAAjB,EAA0B;IACxB,OAAOC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;EACD;;EAED,MAAM;IAAEG;EAAF,IAAyBH,KAA/B,CAL8E,CAM9E;EACA;;EACA,IAAI,CAACG,MAAD,IAAW,CAACA,MAAM,CAACC,KAAvB,EAA8B;IAC5B,OAAOH,OAAO,CAACC,MAAR,CAAeP,aAAa,CAAaK,KAAb,CAA5B,CAAP;EACD;;EAED,IAAI,CAAcA,KAAb,CAAoBK,QAAzB,EAAmC;IACjC,MAAMC,cAAc,GAAGP,WAAW,CAACQ,QAAZ,CAAqB,gBAArB,CAAvB;;IACA,IAAIV,UAAU,CAACS,cAAD,CAAd,EAAgC;MAC9B,OAAOA,cAAc,CAACN,KAAD,EAAQ,IAAR,CAArB,CAD8B,CAE9B;MACA;IACD;EACF;;EAED,MAAMQ,SAAS,GAAGb,aAAa,CAAaK,KAAb,CAA/B;EAEA,OAAOC,OAAO,CAACC,MAAR,CAAeM,SAAf,CAAP;AACD,CAxBD;;AA0BA,MAAMC,kBAAkB,GAAG,MAAqD;EAC9E,OAAO,CAACV,WAAD,EAA2BW,YAA3B,KAAgH,CACpHL,QAAD,IAA8CM,qBAAqB,CAACN,QAAD,EAAWN,WAAX,CADkD,EAErHD,UAAU,CAACC,WAAD,CAF2G,CAAvH;AAID,CALD;;AAMA,OAAO,MAAMY,qBAAqB,GAAG,CAACN,QAAD,EAA0BN,WAA1B,KAAuD,IAAIH,eAAJ,CAC1FS,QAD0F,EAE1FN,WAAW,CAACQ,QAAZ,CAAqB,kBAArB,IAA2C;EAAEK,OAAO,EAAE;AAAX,CAA3C,GAA6D,EAF6B,CAArF;AAKP,eAAeH,kBAAf"}